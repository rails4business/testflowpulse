<%# app/views/posts/_table.html.erb %>
<%# Locals richiesti: posts:, params_hash: %>
<% posts       = local_assigns[:posts] || @posts %>
<% params_hash = local_assigns[:params_hash] || params %>

<%# Helper inline per il link di ordinamento %>
<% sort_link = ->(key, label) do
     current = params_hash[:sort].presence || "published"
     next_order = (params_hash[:order] == "asc" ? "desc" : "asc")
     arrow = if current == key
       params_hash[:order] == "asc" ? "‚¨ÜÔ∏é" : "‚¨áÔ∏é"
     else
       "‚ÜïÔ∏é"
     end
     link_to "#{label} #{arrow}".html_safe,
       url_for(params_hash.to_h.merge(sort: key, order: (current == key ? next_order : "desc"))),
       class: "inline-flex items-center gap-1 text-slate-700 hover:text-blue-700 font-semibold"
   end %>

<div class="md:hidden space-y-3 ">
  <% posts.each do |post| %>
    <div class="rounded-xl border border-slate-200 bg-white p-3 shadow-sm ">
      <div class="flex items-start gap-3">
        <% if post.img_square_url.present? || post.img_orizontal_url.present? %>
          <img src="<%= post.img_square_url || post.img_orizontal_url %>" alt="<%= post.title %>"
               class="w-16 h-16 object-cover rounded-lg border border-slate-200">
        <% end %>
        <div class="min-w-0 grow">
          <h3 class="font-bold text-slate-900">
            <%= link_to(post.title.presence || "Senza titolo", post_path(post), class: "hover:underline") %>
          </h3>
          <p class="text-xs text-slate-500 truncate"><%= post.description %></p>
          <div class="mt-1 flex flex-wrap items-center gap-2 text-xs">
            <% if post.published_at.present? %>
              <span class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 ring-1 ring-emerald-200">Pubblicato</span>
            <% else %>
              <span class="inline-flex items-center rounded-full bg-amber-50 text-amber-700 px-2 py-0.5 ring-1 ring-amber-200">Bozza</span>
            <% end %>
            <span class="text-slate-500">Modificato <%= l(post.updated_at, format: :short) %></span>
          </div>
        </div>
      </div>
      <div class="mt-3 flex items-center justify-between">
        <div class="text-xs text-slate-500">üëÅÔ∏è 0 ¬∑ ‚ù§Ô∏è 0</div>
        <div class="flex items-center gap-2">
          <%= link_to "Vedi", post_path(post), class: "text-blue-700 hover:underline text-xs" %>
          <%= link_to "Modifica", edit_post_path(post), class: "text-slate-700 hover:underline text-xs" %>
          <%= link_to "Elimina", post_path(post),
                method: :delete, data: { confirm: "Eliminare questo post?" },
                class: "text-red-600 hover:underline text-xs" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="hidden md:block  bg-white shadow-sm overflow-hidden w-full">
  <div class="overflow-x-auto w-full">
    <table class="w-full text-sm table-auto"> <!-- <- w-full + table-auto -->
      <thead class="bg-slate-50 text-slate-700 sticky top-0 z-10">
        <tr class="border-b border-slate-200">
          <th class="px-4 py-3 text-left w-16">Img</th>
          <th class="px-4 py-3 text-left">Titolo</th>
          <th class="px-4 py-3 text-left">Stato</th>
          <th class="px-4 py-3 text-left"><%= sort_link.call("published", "Pubblicato") %></th>
          <th class="px-4 py-3 text-left"><%= sort_link.call("updated", "Aggiornato") %></th>
          <th class="px-4 py-3 text-left"><%= sort_link.call("created", "Creato") %></th>
          <th class="px-4 py-3 text-left">Metriche</th>
          <th class="px-4 py-3 text-right w-40">Azioni</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-slate-100">
        <% posts.each do |post| %>
          <tr class="hover:bg-slate-50/60">
            <td class="px-4 py-3">
              <% if post.img_square_url.present? || post.img_orizontal_url.present? %>
                <img src="<%= post.img_square_url || post.img_orizontal_url %>"
                     alt="<%= post.title %>" class="w-12 h-12 object-cover rounded-lg border border-slate-200">
              <% else %>
                <div class="w-12 h-12 rounded-lg border border-dashed border-slate-300 grid place-content-center text-xs text-slate-400">‚Äî</div>
              <% end %>
            </td>
            <td class="px-4 py-3 align-top">
              <div class="font-semibold text-slate-900">
                <%= link_to(post.title.presence || "Senza titolo", post_path(post), class: "hover:underline") %>
              </div>
              <% if post.description.present? %>
                <div class="text-slate-500 line-clamp-1"><%= post.description %></div>
              <% end %>
              <div class="text-[11px] text-slate-400">/<%= post.slug %></div>
            </td>
            <td class="px-4 py-3">
              <% if post.published_at.present? %>
                <span class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 ring-1 ring-emerald-200">Pubblicato</span>
              <% else %>
                <span class="inline-flex items-center rounded-full bg-amber-50 text-amber-700 px-2 py-0.5 ring-1 ring-amber-200">Bozza</span>
              <% end %>
            </td>
            <td class="px-4 py-3 text-slate-700"><%= post.published_at ? l(post.published_at, format: :short) : "‚Äî" %></td>
            <td class="px-4 py-3 text-slate-700"><%= l(post.updated_at, format: :short) %></td>
            <td class="px-4 py-3 text-slate-700"><%= l(post.created_at, format: :short) %></td>
            <td class="px-4 py-3 text-slate-600">üëÅÔ∏è 0 ¬∑ ‚ù§Ô∏è 0</td>
            <td class="px-4 py-3 text-right">
              <div class="inline-flex items-center gap-3">

                <!-- Vedi -->
                <%= link_to post_path(post), class: "text-blue-600 hover:text-blue-800", title: "Vedi" do %>
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1.5 12s4.5-7.5 10.5-7.5S22.5 12 22.5 12s-4.5 7.5-10.5 7.5S1.5 12 1.5 12Z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                <% end %>

                <!-- Modifica -->
                <%= link_to edit_post_path(post), class: "text-slate-600 hover:text-slate-800", title: "Modifica" do %>
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16.862 4.487a2.125 2.125 0 1 1 3.005 3.005L7.5 19.859 3 21l1.141-4.5L16.862 4.487Z"/>
                  </svg>
                <% end %>

                <!-- Elimina -->
                <%= button_to post_path(post),
                      method: :delete,
                      form: { class: "inline", data: { turbo_confirm: "Eliminare questo post?" } },
                      class: "text-red-600 hover:text-red-800",
                      title: "Elimina" do %>
                  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3 6h18M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2m2 0v14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V6h12Z"/>
                  </svg>
                <% end %>

              </div>
            </td>


          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>


<% if posts.blank? %>
  <div class="mt-6 rounded-2xl border-2 border-dashed border-slate-300 bg-gradient-to-br from-white to-slate-50 p-12 text-center">
    <p class="text-slate-600 text-lg md:text-xl font-semibold mb-3">üì≠ Nessun post trovato.</p>
    <p class="text-slate-500 text-sm md:text-base mb-6">Crea il tuo primo post per iniziare</p>
    <%= link_to "‚ûï Crea Nuovo Post", new_post_path,
      class: "inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold px-6 py-3 rounded-lg transition shadow-lg hover:shadow-xl" %>
  </div>
<% end %>
